DESCRIPTION >
    Top device types ordered by visits.

TOKEN "dashboard" READ

NODE endpoint
SQL >
    %
    SELECT
        device_type                      AS device,
        countDistinct(visitor_id)        AS visits,
        count()                          AS hits
    FROM website_visitors
    WHERE 1 = 1

        {% if defined(domain) %}
          AND domain = {{ String(domain) }}
        {% end %}

        {% if defined(date_from) %}
          AND timestamp >= {{ DateTime(date_from) }}
        {% else %}
          AND timestamp >= today() - 7
        {% end %}

        {% if defined(date_to) %}
          AND timestamp <= {{ DateTime(date_to) }}
        {% else %}
          AND timestamp <  today() + 1
        {% end %}

        AND device_type != ''            -- ignore blank rows

    GROUP BY device
    ORDER BY visits DESC
    LIMIT {{ Int32(skip, 0) }}, {{ Int32(limit, 50) }}

TYPE endpoint